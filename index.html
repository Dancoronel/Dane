<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestor de Gastos</title>

<style>
:root{
 --bg:#f3f4f6;
 --card:#ffffff;
 --primary:#2563eb;
 --dark:#0f172a;
 --muted:#6b7280;
 --danger:#dc2626;
}

*{box-sizing:border-box}

body{
 margin:0;
 font-family:system-ui,-apple-system;
 background:var(--bg);
 color:var(--dark);
}

header{
 background:var(--dark);
 color:#fff;
 padding:20px;
}

h1{margin:0;font-size:20px;font-weight:600}
h2{margin:0 0 10px;font-size:18px}
.small{font-size:13px;color:var(--muted)}

.screen{
 display:none;
 padding:18px;
 padding-bottom:100px;
}

.active{display:block}

.card{
 background:var(--card);
 border-radius:16px;
 padding:18px;
 margin-bottom:16px;
 box-shadow:0 3px 10px rgba(0,0,0,.05);
}

.total-box{
 text-align:center;
 padding:24px 16px;
}

.total-box h2{
 font-size:34px;
 margin:8px 0;
}

.mes-nombre{
 font-size:14px;
 color:var(--muted);
}

.row-3{
 display:flex;
 gap:10px;
 margin-bottom:18px;
}

.mini-card{
 flex:1;
 background:var(--card);
 border-radius:14px;
 padding:14px 10px;
 text-align:center;
 box-shadow:0 2px 6px rgba(0,0,0,.05);
 cursor:pointer;
}

.mini-card .mes{
 font-size:13px;
 color:var(--muted);
 margin-bottom:6px;
}

.mini-card .monto{
 font-size:16px;
 font-weight:600;
}

.lista-meses div{
 padding:10px 0;
 border-bottom:1px solid #e5e7eb;
 font-size:14px;
}

.lista-meses div:last-child{
 border:none;
}

.gasto-item{
 display:flex;
 justify-content:space-between;
 padding:12px 0;
 border-bottom:1px solid #e5e7eb;
}

.gasto-item:last-child{
 border:none;
}

.bottom-nav{
 position:fixed;
 bottom:0;left:0;right:0;
 display:flex;
 justify-content:space-around;
 background:var(--dark);
 padding:10px 0;
}

.bottom-nav button{
 background:none;
 border:none;
 color:#fff;
 font-size:14px;
}

button{
 width:100%;
 padding:12px;
 margin-top:10px;
 border-radius:12px;
 border:none;
 font-size:14px;
}

button.primary{background:var(--primary);color:#fff}
button.danger{background:var(--danger);color:#fff}

.fab{
 position:fixed;
 bottom:70px;
 right:20px;
 width:58px;
 height:58px;
 border-radius:50%;
 background:var(--primary);
 color:white;
 font-size:30px;
 border:none;
 box-shadow:0 6px 16px rgba(0,0,0,.25);
}
</style>
</head>
<body>

<header>
<h1>Gestor de Gastos</h1>
</header>

<div id="home" class="screen active">

<div class="card total-box" onclick="verMes(mesActualKey)">
<div class="small">Mes actual</div>
<h2 id="totalMes">$0.00</h2>
<div id="nombreMesActual" class="mes-nombre"></div>
</div>

<div id="tresMeses"></div>

<div class="card">
<div class="small" style="margin-bottom:10px">Próximos 9 meses</div>
<div id="nueveMeses" class="lista-meses"></div>
</div>

</div>

<div id="mesDetalle" class="screen"></div>

<button class="fab" onclick="mostrar('home')">+</button>

<div class="bottom-nav">
<button onclick="mostrar('home')">Home</button>
</div>

<script>
let db = JSON.parse(localStorage.getItem('db')) || {
 ingreso:0,
 metodos:['Efectivo'],
 gastos:[]
};

let mapaMesesGlobal = {};
let mesActualKey = '';

function mostrar(id){
 document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 if(id==='home')calcular();
}

function nombreMes(date){
 return date.toLocaleDateString('es-AR',{month:'long',year:'numeric'});
}

function calcular(){
 let hoy=new Date();
 mesActualKey=hoy.getFullYear()+'-'+String(hoy.getMonth()+1).padStart(2,'0');
 mapaMesesGlobal={};

 db.gastos.forEach(g=>{
  let inicio=new Date(g.f);
  let cuota=Math.round((g.m/g.c)*100)/100;
  for(let i=0;i<g.c;i++){
   let d=new Date(inicio);
   d.setMonth(d.getMonth()+i);
   let key=d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');
   if(!mapaMesesGlobal[key]) mapaMesesGlobal[key]=[];
   mapaMesesGlobal[key].push({desc:g.d,monto:cuota});
  }
 });

 let totalActual=(mapaMesesGlobal[mesActualKey]||[])
  .reduce((a,b)=>a+b.monto,0);

 totalMes.textContent='$'+totalActual.toFixed(2);
 nombreMesActual.textContent=nombreMes(hoy);

 let meses=[];
 for(let i=1;i<=12;i++){
  let d=new Date(hoy);
  d.setMonth(d.getMonth()+i);
  let key=d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');
  meses.push({date:d,key});
 }

 tresMeses.innerHTML=
 `<div class="row-3">`+
 meses.slice(0,3).map(m=>{
  let total=(mapaMesesGlobal[m.key]||[])
   .reduce((a,b)=>a+b.monto,0);
  return `<div class="mini-card" onclick="verMes('${m.key}')">
   <div class="mes">${nombreMes(m.date)}</div>
   <div class="monto">$${total.toFixed(2)}</div>
  </div>`;
 }).join('')
 +`</div>`;

 nueveMeses.innerHTML=
 meses.slice(3).map(m=>{
  let total=(mapaMesesGlobal[m.key]||[])
   .reduce((a,b)=>a+b.monto,0);
  return `<div>${nombreMes(m.date)} — $${total.toFixed(2)}</div>`;
 }).join('');
}

function verMes(key){
 let gastos=mapaMesesGlobal[key]||[];
 let total=gastos.reduce((a,b)=>a+b.monto,0);
 let fechaParts=key.split('-');
 let d=new Date(fechaParts[0],fechaParts[1]-1,1);

 mesDetalle.innerHTML=`
 <div class="card">
 <h2>${nombreMes(d)}</h2>
 <div class="small" style="margin-bottom:8px">Total</div>
 <div style="font-size:26px;font-weight:600;margin-bottom:18px">$${total.toFixed(2)}</div>
 ${gastos.length
   ? gastos.map(g=>`
     <div class="gasto-item">
       <div>${g.desc}</div>
       <div>$${g.monto.toFixed(2)}</div>
     </div>
   `).join('')
   : '<div class="small">No hay gastos este mes</div>'}
 <button onclick="mostrar('home')" style="margin-top:20px">Volver</button>
 </div>
 `;
 mostrar('mesDetalle');
}

calcular();
</script>

</body>
</html>
