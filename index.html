<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestor de Gastos</title>

<style>
:root{
 --primary:#6366f1;
 --primary-dark:#4f46e5;
 --bg:#f8fafc;
 --card:#ffffff;
 --text:#0f172a;
 --muted:#64748b;
 --danger:#ef4444;
 --radius:20px;
}

*{
 box-sizing:border-box;
 -webkit-tap-highlight-color:transparent;
}

body{
 margin:0;
 font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
 background:var(--bg);
 color:var(--text);
}

header{
 background:linear-gradient(135deg,var(--primary),var(--primary-dark));
 color:#fff;
 padding:24px 20px;
 border-bottom-left-radius:30px;
 border-bottom-right-radius:30px;
 box-shadow:0 10px 30px rgba(0,0,0,.15);
}

header h1{
 margin:0;
 font-size:22px;
 font-weight:600;
}

.small{
 font-size:13px;
 color:var(--muted);
}

.screen{
 display:none;
 padding:20px;
 padding-bottom:120px;
}

.active{
 display:block;
}

.card{
 background:var(--card);
 border-radius:var(--radius);
 padding:18px;
 margin-bottom:16px;
 box-shadow:0 8px 25px rgba(0,0,0,.06);
 transition:.2s ease;
}

.card:hover{
 transform:translateY(-2px);
 box-shadow:0 12px 30px rgba(0,0,0,.08);
}

h2,h3{
 margin-top:0;
}

input,select{
 width:100%;
 padding:14px;
 margin:8px 0;
 border-radius:14px;
 border:1px solid #e2e8f0;
 background:#fff;
 font-size:15px;
 transition:.2s;
}

input:focus,select:focus{
 outline:none;
 border-color:var(--primary);
 box-shadow:0 0 0 3px rgba(99,102,241,.15);
}

button{
 width:100%;
 padding:14px;
 margin:10px 0;
 border-radius:16px;
 border:none;
 font-size:15px;
 font-weight:600;
 cursor:pointer;
 transition:.2s ease;
}

button.primary{
 background:var(--primary);
 color:white;
}

button.primary:active{
 transform:scale(.97);
 background:var(--primary-dark);
}

button.danger{
 background:var(--danger);
 color:white;
}

button.danger:active{
 transform:scale(.97);
}

.fab{
 position:fixed;
 bottom:85px;
 right:22px;
 width:64px;
 height:64px;
 border-radius:50%;
 background:var(--primary);
 color:white;
 font-size:34px;
 border:none;
 box-shadow:0 12px 30px rgba(99,102,241,.4);
 display:flex;
 align-items:center;
 justify-content:center;
 transition:.2s ease;
}

.fab:active{
 transform:scale(.92);
}

.bottom-nav{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 display:flex;
 justify-content:space-around;
 background:#ffffff;
 padding:12px 0;
 box-shadow:0 -5px 20px rgba(0,0,0,.08);
 border-top-left-radius:24px;
 border-top-right-radius:24px;
}

.bottom-nav button{
 background:none;
 border:none;
 font-weight:600;
 color:var(--muted);
 font-size:14px;
}

.bottom-nav button:active{
 color:var(--primary);
}

#totalMes{
 font-size:32px;
 font-weight:700;
 margin-top:8px;
}
</style>
</head>
<body>

<header>
<h1>Gestor de Gastos</h1>
<p class="small">Control mensual inteligente</p>
</header>

<div id="home" class="screen active">
<div class="card" style="text-align:center">
<p class="small">Gasto del mes actual</p>
<h2 id="totalMes">$0.00</h2>
</div>

<div class="card">
<p class="small">Próximos 3 meses</p>
<div id="futurosMeses"></div>
</div>
</div>

<div id="new" class="screen">
<h2>Nuevo gasto</h2>
<input id="desc" placeholder="Descripción">
<input id="monto" type="number" step="0.01" placeholder="Monto total">
<select id="tipo">
<option value="1">Pago único</option>
<option value="cuotas">En cuotas</option>
</select>
<input id="cuotas" type="number" placeholder="Cantidad de cuotas">
<label class="small">Fecha del primer pago</label>
<input id="fecha" type="date">
<select id="metodo"></select>
<button class="primary" onclick="guardar()">Guardar gasto</button>
</div>

<div id="list" class="screen">
<h2>Gastos</h2>
<div id="lista"></div>
</div>

<div id="detail" class="screen"></div>

<div id="settings" class="screen">
<h2>Ajustes</h2>
<input id="ingreso" type="number" step="0.01" placeholder="Ingreso mensual">
<h3>Métodos de pago</h3>
<input id="nuevoMetodo" placeholder="Nuevo método">
<button class="primary" onclick="agregarMetodo()">Agregar método</button>
<div id="metodos"></div>
<button class="primary" onclick="guardarAjustes()">Guardar ajustes</button>
</div>

<button class="fab" onclick="mostrar('new')">+</button>

<div class="bottom-nav">
<button onclick="mostrar('home')">Home</button>
<button onclick="mostrar('list')">Gastos</button>
<button onclick="mostrar('settings')">Ajustes</button>
</div>

<script>
let db = JSON.parse(localStorage.getItem('db')) || {
 ingreso:0,
 metodos:['Efectivo'],
 gastos:[]
};

function save(){localStorage.setItem('db',JSON.stringify(db));}

function mostrar(id){
 document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 if(id==='home')calcular();
 if(id==='list')renderLista();
 if(id==='new')cargarMetodos();
 if(id==='settings')renderSettings();
}

function guardar(){
 if(!fecha.value || !metodo.value) return alert('Falta completar datos');
 db.gastos.push({
  id:Date.now(),
  d:desc.value,
  m:+monto.value,
  c:tipo.value==='cuotas'?+cuotas.value:1,
  f:fecha.value,
  p:metodo.value
 });
 save();
 mostrar('home');
}

function calcular(){
 let hoy=new Date();
 let total=0;
 let mapaMeses={};

 db.gastos.forEach(g=>{
  let inicio=new Date(g.f);

  // precisión financiera a 2 decimales
  let cuota = Math.round((g.m / g.c) * 100) / 100;

  for(let i=0;i<g.c;i++){
   let d=new Date(inicio);
   d.setMonth(d.getMonth()+i);
   let key=d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');

   if(d.getMonth()===hoy.getMonth() && d.getFullYear()===hoy.getFullYear()){
    total+=cuota;
   }

   mapaMeses[key]=(mapaMeses[key]||0)+cuota;
  }
 });

 totalMes.textContent='$'+total.toFixed(2);

 let mesesOrdenados = Object.keys(mapaMeses).sort();
 let actuales = mesesOrdenados.filter(k=>{
  let [y,m]=k.split('-').map(Number);
  return y>hoy.getFullYear() || (y===hoy.getFullYear() && m>hoy.getMonth()+1);
 }).slice(0,3);

 let cont=document.getElementById('futurosMeses');
 cont.innerHTML = actuales.length
  ? actuales.map(k=>`<div>${k}: $${mapaMeses[k].toFixed(2)}</div>`).join('')
  : '<div class="small">No hay gastos futuros</div>';
}

function renderLista(){
 lista.innerHTML='';
 db.gastos.forEach(g=>{
  lista.innerHTML+=`
  <div class="card">
   <b>${g.d}</b><br>
   $${g.m.toFixed(2)} – ${g.c} cuotas<br>
   <button onclick="ver(${g.id})">Ver detalle</button>
  </div>`;
 });
}

function ver(id){
 let g=db.gastos.find(x=>x.id===id);
 let fin=new Date(g.f); 
 fin.setMonth(fin.getMonth()+g.c-1);

 detail.innerHTML=`
 <h2>${g.d}</h2>
 <p>Monto total: $${g.m.toFixed(2)}</p>
 <p>Cuotas: ${g.c}</p>
 <p>Primer pago: ${g.f}</p>
 <p>Finaliza: ${fin.toISOString().slice(0,10)}</p>
 <p>Método: ${g.p}</p>
 <button class="danger" onclick="eliminar(${id})">Eliminar</button>
 <button onclick="mostrar('list')">Volver</button>`;
 mostrar('detail');
}

function eliminar(id){
 db.gastos=db.gastos.filter(g=>g.id!==id);
 save(); mostrar('home');
}

function cargarMetodos(){
 metodo.innerHTML='';
 db.metodos.forEach(m=>metodo.innerHTML+=`<option>${m}</option>`);
}

function agregarMetodo(){
 if(!nuevoMetodo.value) return;
 db.metodos.push(nuevoMetodo.value);
 nuevoMetodo.value='';
 save(); renderSettings();
}

function renderSettings(){
 ingreso.value=db.ingreso;
 metodos.innerHTML=db.metodos.map(m=>'<div>'+m+'</div>').join('');
}

function guardarAjustes(){
 db.ingreso=+ingreso.value;
 save(); mostrar('home');
}

calcular();
</script>

</body>
</html>
